---
# Utility tasks to list bucket metrics configuration
#
- name: "List s3 bucket metric configurations"
  command: >
    aws s3api list-bucket-metrics-configurations 
      --bucket {{ test_bucket }}
      --region {{ aws_connection_info.region }}
  environment:
    AWS_ACCESS_KEY_ID: "{{ aws_connection_info.aws_access_key }}"
    AWS_SECRET_ACCESS_KEY: "{{ aws_connection_info.aws_secret_key }}"
    AWS_SESSION_TOKEN: "{{ aws_connection_info.security_token }}"
  register: list_comand_result
  no_log: true


- set_fact:
    metrics_info: "{{ (list_comand_result.stdout | from_json)['MetricsConfigurationList'] | default([]) }}"
